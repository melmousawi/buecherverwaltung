<mvc:View
  controllerName="buecherverwaltung.controller.Main"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core">

  <Page title="📚 Bücherverwaltung">
    <content>

    <Toolbar class="sapUiSmallMarginBottom">
        <Title text="📖 Bücherliste" level="H2"/>
        <ToolbarSpacer/>
        <!-- Button öffnet Dialog zum Anlegen -->
        <Button text="➕ Neues Buch" type="Emphasized" press=".onOpenCreateDialog"/>
        <!-- Event beim Tippen. 
        value="{/filter/searchText}" bindet den Wert an das Filter-Model und sorgt dafür, dass Änderungen am Model direkt im Feld sichtbar werden. -->
      <SearchField
      width="20rem"
      placeholder="Titel suchen..."
      liveChange=".onSearchBooks"
      value="{/filter/searchText}"    
      search=".onSearchBooks" />
    </Toolbar>

      <!-- Filter-Bereich für Datumsfilterung -->
      <Panel headerText="🔍 Filter nach Anlegedatum" class="sapUiSmallMarginBottom">
        <content>
          <HBox justifyContent="Start" alignItems="Center" class="sapUiSmallMargin">
            
            <Label text="Von:" class="sapUiTinyMarginEnd"/>
            
            <DatePicker 
              value="{/filter/startDate}" 
              change=".onStartDateChange"
              tooltip="Startdatum wählen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <Label text="Bis:" class="sapUiTinyMarginEnd"/>
            <DatePicker 
              value="{/filter/endDate}" 
              change=".onEndDateChange"
              tooltip="Enddatum wählen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <Button 
              text="Filter zurücksetzen" 
              type="Transparent" 
              press=".onResetFilter"
              icon="sap-icon://clear-filter"
              tooltip="Alle Filter zurücksetzen und alle Bücher anzeigen"/>
            <!-- 
              ToolbarSpacer sorgt dafür, dass der folgende Text rechtsbündig angezeigt wird.
              Ohne diesen Spacer würden alle Elemente linksbündig angeordnet.
            -->
            <ToolbarSpacer/>
            <Text 
              text="{/filter/filteredCount} von {/filter/totalCount} Büchern" 
              class="sapUiTinyMarginEnd"/>
          </HBox>
        </content>
      </Panel>

      <Table
        items="{/filteredBooks}"
        inset="false"
        class="sapUiResponsiveMargin">
        <!-- Header der Tabelle -->
        <headerToolbar>
          <Toolbar>
            <Title text="Bücher" level="H3"/>
          </Toolbar>
        </headerToolbar>
        <!-- Spalten -->
        <columns>
          <Column><Text text="Titel"/></Column>
          <Column><Text text="Autor"/></Column>
          <Column><Text text="Angelegt am"/></Column>
          <Column><Text text="Angelegt von"/></Column>
          <Column hAlign="Center" width="10rem"><Text text="Aktionen"/></Column>
        </columns>
        <!-- Zeilen-Template: Bindung an jedes Buch-Objekt -->
        <items>
          <ColumnListItem>
            <cells>
              <!-- Titel -->
              <Text text="{title}"/>
              <!-- Autor -->
              <Text text="{author}"/>
              <!-- Angelegt am (benutzerfreundlich formatiert) -->
              <Text text="{formattedCreatedAt}"/>
              <!-- Angelegt von -->
              <Text text="{createdBy}"/>
              <!-- Aktionen -->
              <HBox justifyContent="Center" alignItems="Center">
                <!-- Bearbeiten-Button: ruft onEditBook auf -->
                <Button icon="sap-icon://edit" tooltip="Bearbeiten" press=".onEditBook"/>
                <!-- Löschen-Button: ruft onDeleteBook auf. Zunächst auskommentiert --> 
                <!-- <Button icon="sap-icon://delete" tooltip="Löschen" type="Transparent" press=".onDeleteBook"/> -->
              </HBox>
            </cells>
          </ColumnListItem>
        </items>
      </Table>

      <!-- Dialog: Neues Buch anlegen -->
      <Dialog
        id="createDialog"
        title="Neues Buch anlegen"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe für Titel `Input value="{/newBook/title}"` schreibt automatisch ins Model. -->
          <Label text="Titel"/>
          <Input value="{/newBook/title}" placeholder="Titel"/>
          <!-- Eingabe für Autor -->
          <Label text="Autor"/>
          <Input value="{/newBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/newBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onCreateBook auf -->
          <Button text="Speichern" press=".onCreateBook"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schließt Dialog -->
          <Button text="Abbrechen" press=".onCancelCreate"/>
        </endButton>
      </Dialog>

      <!-- Dialog: Buch bearbeiten -->
      <Dialog
        id="editDialog"
        title="Buch bearbeiten"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe für Titel -->
          <Label text="Titel"/>
          <Input value="{/editBook/title}" placeholder="Titel"/>
          <!-- Eingabe für Autor -->
          <Label text="Autor"/>
          <Input value="{/editBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/editBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onSaveDraft auf -->
          <Button text="Speichern" press=".onSaveDraft"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schließt Dialog -->
          <Button text="Abbrechen" press=".onCancelDraft"/>
        </endButton>
      </Dialog>

    </content>
  </Page>
</mvc:View>
