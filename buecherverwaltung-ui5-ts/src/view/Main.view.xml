<!-- <mvc:View = Das ist ein UI5-View-Element (wie ein Container fÃ¼r meine UI) -->
<!-- controllerName="buecherverwaltung.controller.Main verknÃ¼pft diese View mit dem Main-Controller (wo meine Logik steht). 
Das ist der Name des Controllers, der fÃ¼r diese View verantwortlich ist. -->
<!-- xmlns = Das ist ein Namespace-PrÃ¤fix fÃ¼r die UI5-Bibliotheken -->
<!-- xmlns:mvc = Das ist ein Namespace-PrÃ¤fix fÃ¼r die UI5-MVC-Bibliotheken -->

<mvc:View
  controllerName="buecherverwaltung.controller.Main"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core">

  <!-- 
    Hauptseite fÃ¼r die BÃ¼cherverwaltung.
    EnthÃ¤lt:
    - Toolbar mit "Neues Buch"-Button
    - Tabelle mit BÃ¼chern (Titel, Autor, Angelegt am, Angelegt von)
    - Dialoge fÃ¼r Neues Buch & Bearbeiten 
  -->
  <Page title="ðŸ“š BÃ¼cherverwaltung">

    <!-- Inhalt der Seite -->
    <content>

      <!-- Toolbar: Ãœberschrift + Button -->
    <Toolbar class="sapUiSmallMarginBottom">
        <!-- Titel -->
        <Title text="ðŸ“– BÃ¼cherliste" level="H2"/>
        <ToolbarSpacer/>
        <!-- Button Ã¶ffnet Dialog zum Anlegen -->
        <Button text="âž• Neues Buch" type="Emphasized" press=".onOpenCreateDialog"/>

        <!-- NEU: Suchfeld -->
        <!-- wichtig: Event beim Tippen -->
        <!--value="{/filter/searchText}" sorgt dafÃ¼r, dass Ã„nderungen am Model direkt im Feld sichtbar werden. -->
    
      <!-- <SearchField
      width="20rem"
      placeholder="Titel suchen..."
      liveChange=".onSearchBooks"
      value="{/filter/searchText}"    
      search=".onSearchBooks" /> -->

    </Toolbar>

      <!-- NEU: Filter-Bereich fÃ¼r Datumsfilterung -->
      <!-- 
        Dieser Bereich ermÃ¶glicht es dem Benutzer, BÃ¼cher nach dem Anlegedatum zu filtern.
        Wir verwenden zwei DatePicker-Komponenten fÃ¼r Start- und Enddatum.
        Der Filter wird automatisch angewendet, sobald sich eines der Daten Ã¤ndert.
      -->
      <Panel headerText="ðŸ” Filter nach Anlegedatum" class="sapUiSmallMarginBottom">
        <content>
          <!-- 
            HBox dient als Container fÃ¼r die Filter-Elemente.
            justifyContent="Start" sorgt dafÃ¼r, dass alle Elemente linksbÃ¼ndig angeordnet werden.
            alignItems="Center" zentriert alle Elemente vertikal.
          -->
          <HBox justifyContent="Start" alignItems="Center" class="sapUiSmallMargin">
            
            <!-- 
              Label fÃ¼r das Startdatum.
              "sapUiTinyMarginEnd" fÃ¼gt einen kleinen rechten Rand hinzu,
              damit das Label nicht direkt am DatePicker klebt.
            -->
            <Label text="Von:" class="sapUiTinyMarginEnd"/>
            
            <!-- 
              DatePicker fÃ¼r das Startdatum.
              - value="{/filter/startDate}" bindet den Wert an das Filter-Model
              - change=".onStartDateChange" ruft die Filter-Funktion auf
              - tooltip zeigt einen Hinweistext, wenn der Benutzer mit der Maus darÃ¼ber fÃ¤hrt
              - displayFormat bestimmt, wie das Datum angezeigt wird (deutsches Format)
            -->
            <DatePicker 
              value="{/filter/startDate}" 
              change=".onStartDateChange"
              tooltip="Startdatum wÃ¤hlen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <!-- 
              Label fÃ¼r das Enddatum.
              "sapUiTinyMarginEnd" sorgt fÃ¼r Abstand zum nÃ¤chsten Element.
            -->
            <Label text="Bis:" class="sapUiTinyMarginEnd"/>
            
            <!-- 
              DatePicker fÃ¼r das Enddatum.
              - value="{/filter/endDate}" bindet den Wert an das Filter-Model
              - change=".onEndDateChange" ruft die Filter-Funktion auf
              - tooltip zeigt einen Hinweistext, wenn der Benutzer mit der Maus darÃ¼ber fÃ¤hrt
              - displayFormat bestimmt, wie das Datum angezeigt wird (deutsches Format)
            -->
            <DatePicker 
              value="{/filter/endDate}" 
              change=".onEndDateChange"
              tooltip="Enddatum wÃ¤hlen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <!-- 
              Button zum ZurÃ¼cksetzen des Filters.
              - type="Transparent" macht den Button weniger prominent
              - press=".onResetFilter" ruft die Reset-Funktion auf
              - icon="sap-icon://clear-filter" zeigt ein LÃ¶sch-Symbol
              - tooltip erklÃ¤rt die Funktion des Buttons
            -->
            <Button 
              text="Filter zurÃ¼cksetzen" 
              type="Transparent" 
              press=".onResetFilter"
              icon="sap-icon://clear-filter"
              tooltip="Alle Filter zurÃ¼cksetzen und alle BÃ¼cher anzeigen"/>
            
            <!-- 
              ToolbarSpacer sorgt dafÃ¼r, dass der folgende Text rechtsbÃ¼ndig angezeigt wird.
              Ohne diesen Spacer wÃ¼rden alle Elemente linksbÃ¼ndig angeordnet.
            -->
            <ToolbarSpacer/>
            
            <!-- 
              Text-Element zeigt die Anzahl der gefilterten BÃ¼cher an.
              - text="{/filter/filteredCount} von {/filter/totalCount} BÃ¼chern" 
                zeigt "X von Y BÃ¼chern" an
              - class="sapUiTinyMarginEnd" fÃ¼gt einen kleinen rechten Rand hinzu
            -->
            <Text 
              text="{/filter/filteredCount} von {/filter/totalCount} BÃ¼chern" 
              class="sapUiTinyMarginEnd"/>
          </HBox>
        </content>
      </Panel>

      <!-- Tabelle mit allen BÃ¼chern -->
      <!-- 
        WICHTIG: Die Tabelle ist jetzt an {/filteredBooks} gebunden, nicht mehr an {/books}.
        Das bedeutet:
        - Wenn kein Filter gesetzt ist: Alle BÃ¼cher werden angezeigt
        - Wenn ein Filter gesetzt ist: Nur die gefilterten BÃ¼cher werden angezeigt
        - Die Filterung passiert automatisch im Controller
      -->
      <Table
        items="{/filteredBooks}"
        inset="false"
        class="sapUiResponsiveMargin">

        <!-- Header der Tabelle -->
        <headerToolbar>
          <Toolbar>
            <Title text="BÃ¼cher" level="H3"/>
          </Toolbar>
        </headerToolbar>

        <!-- Spalten -->
        <columns>
          <Column><Text text="Titel"/></Column>
          <Column><Text text="Autor"/></Column>
          <Column><Text text="Angelegt am"/></Column>
          <Column><Text text="Angelegt von"/></Column>
          <Column hAlign="Center" width="10rem"><Text text="Aktionen"/></Column>
        </columns>

        <!-- Zeilen-Template: Bindung an jedes Buch-Objekt -->
        <items>
          <ColumnListItem>
            <cells>
              <!-- Titel -->
              <Text text="{title}"/>
              <!-- Autor -->
              <Text text="{author}"/>
              <!-- Angelegt am (benutzerfreundlich formatiert) -->
              <Text text="{formattedCreatedAt}"/>
              <!-- Angelegt von -->
              <Text text="{createdBy}"/>
              <!-- Aktionen -->
              <HBox justifyContent="Center" alignItems="Center">
                <!-- Bearbeiten-Button: ruft onEditBook auf -->
                <Button icon="sap-icon://edit" tooltip="Bearbeiten" press=".onEditBook"/>
                <!-- LÃ¶schen-Button: ruft onDeleteBook auf -->
                <!-- <Button icon="sap-icon://delete" tooltip="LÃ¶schen" type="Transparent" press=".onDeleteBook"/> -->
              </HBox>
            </cells>
          </ColumnListItem>
        </items>
      </Table>

      <!-- Dialog: Neues Buch anlegen -->
      <Dialog
        id="createDialog"
        title="Neues Buch anlegen"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe fÃ¼r Titel `Input value="{/newBook/title}"` schreibt automatisch ins Model. -->
          <Label text="Titel"/>
          <Input value="{/newBook/title}" placeholder="Titel"/>
          <!-- Eingabe fÃ¼r Autor -->
          <Label text="Autor"/>
          <Input value="{/newBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/newBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onCreateBook auf -->
          <Button text="Speichern" press=".onCreateBook"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schlieÃŸt Dialog -->
          <Button text="Abbrechen" press=".onCancelCreate"/>
        </endButton>
      </Dialog>

      <!-- Dialog: Buch bearbeiten -->
      <Dialog
        id="editDialog"
        title="Buch bearbeiten"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe fÃ¼r Titel -->
          <Label text="Titel"/>
          <Input value="{/editBook/title}" placeholder="Titel"/>
          <!-- Eingabe fÃ¼r Autor -->
          <Label text="Autor"/>
          <Input value="{/editBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/editBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onSaveDraft auf -->
          <Button text="Speichern" press=".onSaveDraft"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schlieÃŸt Dialog -->
          <Button text="Abbrechen" press=".onCancelDraft"/>
        </endButton>
      </Dialog>

    </content>
  </Page>
</mvc:View>
