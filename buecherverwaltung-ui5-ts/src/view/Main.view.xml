<!-- <mvc:View = Das ist ein UI5-View-Element (wie ein Container für meine UI) -->
<!-- controllerName="buecherverwaltung.controller.Main verknüpft diese View mit dem Main-Controller (wo meine Logik steht). 
Das ist der Name des Controllers, der für diese View verantwortlich ist. -->
<!-- xmlns = Das ist ein Namespace-Präfix für die UI5-Bibliotheken -->
<!-- xmlns:mvc = Das ist ein Namespace-Präfix für die UI5-MVC-Bibliotheken -->

<mvc:View
  controllerName="buecherverwaltung.controller.Main"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core">

  <!-- 
    Hauptseite für die Bücherverwaltung.
    Enthält:
    - Toolbar mit "Neues Buch"-Button
    - Tabelle mit Büchern (Titel, Autor, Angelegt am, Angelegt von)
    - Dialoge für Neues Buch & Bearbeiten 
  -->
  <Page title="📚 Bücherverwaltung">

    <!-- Inhalt der Seite -->
    <content>

      <!-- Toolbar: Überschrift + Button -->
    <Toolbar class="sapUiSmallMarginBottom">
        <!-- Titel -->
        <Title text="📖 Bücherliste" level="H2"/>
        <ToolbarSpacer/>
        <!-- Button öffnet Dialog zum Anlegen -->
        <Button text="➕ Neues Buch" type="Emphasized" press=".onOpenCreateDialog"/>

        <!-- NEU: Suchfeld -->
        <!-- wichtig: Event beim Tippen -->
        <!--value="{/filter/searchText}" sorgt dafür, dass Änderungen am Model direkt im Feld sichtbar werden. -->
    
      <!-- <SearchField
      width="20rem"
      placeholder="Titel suchen..."
      liveChange=".onSearchBooks"
      value="{/filter/searchText}"    
      search=".onSearchBooks" /> -->

    </Toolbar>

      <!-- NEU: Filter-Bereich für Datumsfilterung -->
      <!-- 
        Dieser Bereich ermöglicht es dem Benutzer, Bücher nach dem Anlegedatum zu filtern.
        Wir verwenden zwei DatePicker-Komponenten für Start- und Enddatum.
        Der Filter wird automatisch angewendet, sobald sich eines der Daten ändert.
      -->
      <Panel headerText="🔍 Filter nach Anlegedatum" class="sapUiSmallMarginBottom">
        <content>
          <!-- 
            HBox dient als Container für die Filter-Elemente.
            justifyContent="Start" sorgt dafür, dass alle Elemente linksbündig angeordnet werden.
            alignItems="Center" zentriert alle Elemente vertikal.
          -->
          <HBox justifyContent="Start" alignItems="Center" class="sapUiSmallMargin">
            
            <!-- 
              Label für das Startdatum.
              "sapUiTinyMarginEnd" fügt einen kleinen rechten Rand hinzu,
              damit das Label nicht direkt am DatePicker klebt.
            -->
            <Label text="Von:" class="sapUiTinyMarginEnd"/>
            
            <!-- 
              DatePicker für das Startdatum.
              - value="{/filter/startDate}" bindet den Wert an das Filter-Model
              - change=".onStartDateChange" ruft die Filter-Funktion auf
              - tooltip zeigt einen Hinweistext, wenn der Benutzer mit der Maus darüber fährt
              - displayFormat bestimmt, wie das Datum angezeigt wird (deutsches Format)
            -->
            <DatePicker 
              value="{/filter/startDate}" 
              change=".onStartDateChange"
              tooltip="Startdatum wählen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <!-- 
              Label für das Enddatum.
              "sapUiTinyMarginEnd" sorgt für Abstand zum nächsten Element.
            -->
            <Label text="Bis:" class="sapUiTinyMarginEnd"/>
            
            <!-- 
              DatePicker für das Enddatum.
              - value="{/filter/endDate}" bindet den Wert an das Filter-Model
              - change=".onEndDateChange" ruft die Filter-Funktion auf
              - tooltip zeigt einen Hinweistext, wenn der Benutzer mit der Maus darüber fährt
              - displayFormat bestimmt, wie das Datum angezeigt wird (deutsches Format)
            -->
            <DatePicker 
              value="{/filter/endDate}" 
              change=".onEndDateChange"
              tooltip="Enddatum wählen"
              displayFormat="dd.MM.yyyy"
              class="sapUiTinyMarginEnd"/>
            
            <!-- 
              Button zum Zurücksetzen des Filters.
              - type="Transparent" macht den Button weniger prominent
              - press=".onResetFilter" ruft die Reset-Funktion auf
              - icon="sap-icon://clear-filter" zeigt ein Lösch-Symbol
              - tooltip erklärt die Funktion des Buttons
            -->
            <Button 
              text="Filter zurücksetzen" 
              type="Transparent" 
              press=".onResetFilter"
              icon="sap-icon://clear-filter"
              tooltip="Alle Filter zurücksetzen und alle Bücher anzeigen"/>
            
            <!-- 
              ToolbarSpacer sorgt dafür, dass der folgende Text rechtsbündig angezeigt wird.
              Ohne diesen Spacer würden alle Elemente linksbündig angeordnet.
            -->
            <ToolbarSpacer/>
            
            <!-- 
              Text-Element zeigt die Anzahl der gefilterten Bücher an.
              - text="{/filter/filteredCount} von {/filter/totalCount} Büchern" 
                zeigt "X von Y Büchern" an
              - class="sapUiTinyMarginEnd" fügt einen kleinen rechten Rand hinzu
            -->
            <Text 
              text="{/filter/filteredCount} von {/filter/totalCount} Büchern" 
              class="sapUiTinyMarginEnd"/>
          </HBox>
        </content>
      </Panel>

      <!-- Tabelle mit allen Büchern -->
      <!-- 
        WICHTIG: Die Tabelle ist jetzt an {/filteredBooks} gebunden, nicht mehr an {/books}.
        Das bedeutet:
        - Wenn kein Filter gesetzt ist: Alle Bücher werden angezeigt
        - Wenn ein Filter gesetzt ist: Nur die gefilterten Bücher werden angezeigt
        - Die Filterung passiert automatisch im Controller
      -->
      <Table
        items="{/filteredBooks}"
        inset="false"
        class="sapUiResponsiveMargin">

        <!-- Header der Tabelle -->
        <headerToolbar>
          <Toolbar>
            <Title text="Bücher" level="H3"/>
          </Toolbar>
        </headerToolbar>

        <!-- Spalten -->
        <columns>
          <Column><Text text="Titel"/></Column>
          <Column><Text text="Autor"/></Column>
          <Column><Text text="Angelegt am"/></Column>
          <Column><Text text="Angelegt von"/></Column>
          <Column hAlign="Center" width="10rem"><Text text="Aktionen"/></Column>
        </columns>

        <!-- Zeilen-Template: Bindung an jedes Buch-Objekt -->
        <items>
          <ColumnListItem>
            <cells>
              <!-- Titel -->
              <Text text="{title}"/>
              <!-- Autor -->
              <Text text="{author}"/>
              <!-- Angelegt am (benutzerfreundlich formatiert) -->
              <Text text="{formattedCreatedAt}"/>
              <!-- Angelegt von -->
              <Text text="{createdBy}"/>
              <!-- Aktionen -->
              <HBox justifyContent="Center" alignItems="Center">
                <!-- Bearbeiten-Button: ruft onEditBook auf -->
                <Button icon="sap-icon://edit" tooltip="Bearbeiten" press=".onEditBook"/>
                <!-- Löschen-Button: ruft onDeleteBook auf -->
                <!-- <Button icon="sap-icon://delete" tooltip="Löschen" type="Transparent" press=".onDeleteBook"/> -->
              </HBox>
            </cells>
          </ColumnListItem>
        </items>
      </Table>

      <!-- Dialog: Neues Buch anlegen -->
      <Dialog
        id="createDialog"
        title="Neues Buch anlegen"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe für Titel `Input value="{/newBook/title}"` schreibt automatisch ins Model. -->
          <Label text="Titel"/>
          <Input value="{/newBook/title}" placeholder="Titel"/>
          <!-- Eingabe für Autor -->
          <Label text="Autor"/>
          <Input value="{/newBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/newBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onCreateBook auf -->
          <Button text="Speichern" press=".onCreateBook"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schließt Dialog -->
          <Button text="Abbrechen" press=".onCancelCreate"/>
        </endButton>
      </Dialog>

      <!-- Dialog: Buch bearbeiten -->
      <Dialog
        id="editDialog"
        title="Buch bearbeiten"
        class="sapUiContentPadding">
        <VBox>
          <!-- Eingabe für Titel -->
          <Label text="Titel"/>
          <Input value="{/editBook/title}" placeholder="Titel"/>
          <!-- Eingabe für Autor -->
          <Label text="Autor"/>
          <Input value="{/editBook/author}" placeholder="Autor"/>
            <Label text="Angelegt von"/>
          <Input value="{/editBook/createdBy}" placeholder="Angelegt von"/>
        </VBox>
        <beginButton>
          <!-- Speichern ruft onSaveDraft auf -->
          <Button text="Speichern" press=".onSaveDraft"/>
        </beginButton>
        <endButton>
          <!-- Abbrechen schließt Dialog -->
          <Button text="Abbrechen" press=".onCancelDraft"/>
        </endButton>
      </Dialog>

    </content>
  </Page>
</mvc:View>
